<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questionnaire</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Questionnaire</h1>
    <h2 id="finalScoreHeader"></h2>
    <div id="questionContainer"></div>
    <div id="finalScore"></div>
    <script>
        var score = 0; // Initialiser le score à 0
        var totalQuestions = 1; // Nombre total de questions

        function enableDragAndDrop() {
            document.querySelectorAll('.actions .draggable').forEach(draggable => {
                draggable.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', e.target.dataset.action);
                    e.dataTransfer.effectAllowed = 'move';
                });
            });

            document.querySelectorAll('.dropzone').forEach(dropzone => {
                dropzone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    dropzone.classList.add('highlight');
                });

                dropzone.addEventListener('dragleave', () => {
                    dropzone.classList.remove('highlight');
                });

                dropzone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const data = e.dataTransfer.getData('text/plain');
                    const draggedElement = document.querySelector(`.draggable[data-action='${data}']`);
                    if (draggedElement) {
                        e.target.textContent = draggedElement.textContent;
                        e.target.dataset.action = data;
                        dropzone.classList.remove('highlight');
                    }
                });
            });
        }

        function showFinalScore() {
            var percentage = (score / totalQuestions) * 100; // Calculer le score en pourcentage
            document.getElementById('finalScore').textContent = "Final Score: " + score + "/" + totalQuestions + " (" + percentage.toFixed(2) + "%)";
            document.getElementById('finalScoreHeader').textContent = "Final Score: " + score + "/" + totalQuestions + " (" + percentage.toFixed(2) + "%)"; // Afficher le score final dans le header
        }

        function loadQuestion(file) {
            fetch(file)
                .then(response => response.text())
                .then(data => {
                    document.getElementById('questionContainer').innerHTML = data;
                    enableDragAndDrop();
                    // Re-attacher les écouteurs d'événements pour chaque bouton "Solution"
                    var solutionButtons = document.querySelectorAll('.solutionButton');
                    solutionButtons.forEach(button => {
                        button.addEventListener('click', function() {
                            var solutionInfoId = this.dataset.solutionInfoId;
                            var correctAnswer = this.dataset.correctAnswer.split(',');
                            let isCorrect = true;
                            let userAnswer = [];

                            if (this.dataset.answerName === 'answer1') {
                                const dropzone1 = document.querySelector('#dropzoneAction1').dataset.action;
                                const dropzone2 = document.querySelector('#dropzoneAction2').dataset.action;
                                const dropzone3 = document.querySelector('#dropzoneAction3').dataset.action;
                                const dropzone4 = document.querySelector('#dropzoneAction4').dataset.action;
                                const dropzone5 = document.querySelector('#dropzoneAction5').dataset.action;
                                userAnswer = [dropzone1, dropzone2, dropzone3, dropzone4, dropzone5];

                                userAnswer.forEach((answer, index) => {
                                    if (answer !== correctAnswer[index]) {
                                        isCorrect = false;
                                    }
                                });

                                const solutionText = this.dataset.solutionText;
                                const solutionInfo = document.getElementById(solutionInfoId);
                                if (isCorrect) {
                                    solutionInfo.innerHTML = solutionText;
                                    solutionInfo.classList.remove('incorrect');
                                    solutionInfo.classList.add('highlight');
                                    score += 1; // Ajouter un point si la réponse est correcte
                                } else {
                                    const userAnswerText = userAnswer.length ? userAnswer.join(', ') : "non défini";
                                    solutionInfo.innerHTML = `Your answer: ${userAnswerText}.<br><br>Correct answer: ${correctAnswer.join(', ')}.<br>For reference: <a href='https://learn.microsoft.com/en-us/troubleshoot/windows-server/identity/transfer-or-seize-operation-master-roles-in-ad-ds#seize-or-transfer-operation-master-roles' target='_blank'>Seize or transfer operation master roles</a>`;
                                    solutionInfo.classList.remove('highlight');
                                    solutionInfo.classList.add('incorrect');
                                }

                                solutionInfo.style.display = 'block';
                                showFinalScore();
                            }
                        });
                    });
                })
                .catch(error => console.error('Error loading question:', error));
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Charger la première question
            loadQuestion('question1.html');
        });
    </script>
</body>
</html>
